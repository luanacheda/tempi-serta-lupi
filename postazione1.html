<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sede Lupi - Serta Lupi</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px auto;
        }
        th, td {
            border: 1px solid black;
            padding: 10px;
            text-align: center;
            width: 150px;
        }
        button {
            padding: 10px 15px;
            background-color: #28a745;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #218838;
        }
        .controls {
            text-align: center;
            margin: 20px;
        }
    </style>
</head>
<body>
    <h1>Sede Lupi - Decodifica e partenza discesista</h1>
    <table id="time-table">
        <tr>
            <th>Sestena</th>
            <th>Inizio decodifica</th>
            <th>Fine decodifica</th>
            <th>Partenza discesista</th>
        </tr>
        <tr>
            <td>01</td>
            <td id="time-squadra-1"><button onclick="recordStartTime(1)">Via!</button></td>
            <td id="time-squadra-2"><button onclick="recordStartTime(2)">Stop</button></td>
            <td id="time-squadra-3"><button onclick="recordStartTime(3)">Via!</button></td>
        </tr>
        <tr>
            <td>02</td>
            <td id="time-squadra-4"><button onclick="recordStartTime(4)">Via!</button></td>
            <td id="time-squadra-5"><button onclick="recordStartTime(5)">Stop</button></td>
            <td id="time-squadra-6"><button onclick="recordStartTime(6)">Via!</button></td>
        </tr>
        <tr>
            <td>03</td>
            <td id="time-squadra-7"><button onclick="recordStartTime(7)">Via!</button></td>
            <td id="time-squadra-8"><button onclick="recordStartTime(8)">Stop</button></td>
            <td id="time-squadra-9"><button onclick="recordStartTime(9)">Via!</button></td>
        </tr>
        <tr>
            <td>04</td>
            <td id="time-squadra-10"><button onclick="recordStartTime(10)">Via!</button></td>
            <td id="time-squadra-11"><button onclick="recordStartTime(11)">Stop</button></td>
            <td id="time-squadra-12"><button onclick="recordStartTime(12)">Via!</button></td>
        </tr>
        <tr>
            <td>05</td>
            <td id="time-squadra-13"><button onclick="recordStartTime(13)">Via!</button></td>
            <td id="time-squadra-14"><button onclick="recordStartTime(14)">Stop</button></td>
            <td id="time-squadra-15"><button onclick="recordStartTime(15)">Via!</button></td>
        </tr>
    </table>

    <!-- Controlli per il reset e l'esportazione -->
    <div class="controls">
        <button onclick="resetTimes()">Resetta Tempi</button>
        <button onclick="exportTable()">Esporta Tabella</button>
    </div>

    <script>
        // Funzione per registrare il tempo
        function recordStartTime(team) {
            const currentTime = new Date().toLocaleTimeString();  // Ottiene l'orario corrente
            document.getElementById('time-squadra-' + team).innerHTML = currentTime;  // Mostra l'orario nella cella corrispondente
            saveTime(team, currentTime);  // Salva l'orario in LocalStorage
        }

        // Funzione per salvare i tempi in LocalStorage
        function saveTime(team, time) {
            let savedTimes = JSON.parse(localStorage.getItem('savedTimes')) || {};
            savedTimes['time-squadra-' + team] = time;
            localStorage.setItem('savedTimes', JSON.stringify(savedTimes));
        }

        // Funzione per caricare i tempi salvati da LocalStorage
        function loadSavedTimes() {
            let savedTimes = JSON.parse(localStorage.getItem('savedTimes')) || {};
            for (let key in savedTimes) {
                if (savedTimes.hasOwnProperty(key)) {
                    document.getElementById(key).innerHTML = savedTimes[key];
                }
            }
        }

        // Funzione per resettare i tempi
        function resetTimes() {
            if (confirm("Sei sicuro di voler resettare tutti i tempi?")) {
                localStorage.removeItem('savedTimes');  // Cancella i tempi salvati
                location.reload();  // Ricarica la pagina per ripristinare i bottoni
            }
        }

        // Funzione per esportare la tabella in formato CSV
        function exportTable() {
            let table = document.getElementById("time-table");
            let rows = table.rows;
            let csvContent = "";

            for (let i = 0; i < rows.length; i++) {
                let row = [];
                let cols = rows[i].querySelectorAll("td, th");
                for (let j = 0; j < cols.length; j++) {
                    row.push(cols[j].innerText);
                }
                csvContent += row.join(",") + "\n";
            }

            // Crea un file CSV e lo scarica
            let blob = new Blob([csvContent], { type: 'text/csv' });
            let link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'tempi_staffetta.csv';
            link.click();
        }

        // Carica i tempi salvati quando la pagina viene caricata
        window.onload = loadSavedTimes;
    </script>
</body>
</html>
